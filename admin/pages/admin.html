<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Administrativo Completo - Dr. Marcio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="effects.css">
    <style>
        .admin-container {
            max-width: 1920px; /* Aumentar largura máxima */
            margin: 0 auto;
            padding: 20px 30px; /* Reduzir padding lateral */
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 20px; /* Reduzir margem */
            padding: 20px 30px; /* Reduzir padding */
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            position: relative;
        }

        .admin-header .btn-voltar {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .admin-header .btn-voltar:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .admin-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            font-size: 18px;
            opacity: 0.9;
        }

        /* Separadores visuais para seções */
        .section-separator {
            border: none;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            margin: 40px 0;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .section-title {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            margin: 30px 0 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .section-title h2 {
            color: #333;
            margin: 0;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title p {
            color: #666;
            margin: 5px 0 0 0;
            font-size: 0.95em;
        }

        /* Sistema de Status */
        .system-status-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 colunas iguais */
            gap: 20px;
            margin-bottom: 25px;
        }
        
        /* Responsivo: Em tablets, 2 colunas */
        @media (max-width: 1024px) {
            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Responsivo: Em mobile, 1 coluna */
        @media (max-width: 768px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .status-card {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .status-card h4 {
            margin: 0 0 15px 0;
            color: #374151;
            font-size: 0.9em;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-dot.online {
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-dot.offline {
            background: #ef4444;
        }
        
        .status-dot.loading {
            background: #f59e0b;
            animation: blink 1s infinite;
        }
        
        .big-number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(102, 126, 234, 0.2);
            line-height: 1;
        }
        
        .stats-info {
            font-size: 0.8em;
            color: #6b7280;
        }
        
        .quick-tests {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn-test {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .btn-test:hover {
            background: #5a67d8;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .test-results {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }
        
        .test-success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .test-error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        /* Seção de Cadastro */
        .cadastro-funcionario-section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .btn-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .cadastro-form {
            padding: 30px;
            background: #f8f9fa;
        }

        .form-grid-cadastro {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .foto-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .foto-preview {
            width: 150px;
            height: 150px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            background: white;
        }

        .foto-preview:hover {
            border-color: #5a6fd8;
            background: #f8f9ff;
        }

        .foto-preview input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .foto-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .foto-preview i {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 8px;
        }

        .foto-preview span {
            color: #667eea;
            font-size: 12px;
            text-align: center;
        }

        .btn-foto {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .dados-pessoais,
        .dados-profissionais,
        .permissoes-cadastro {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .dados-pessoais h3,
        .dados-profissionais h3,
        .permissoes-cadastro h3 {
            margin: 0 0 20px 0;
            color: #1e3c72;
            font-size: 16px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-col label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #1e3c72;
            font-size: 14px;
        }

        .form-col input,
        .form-col select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-col input:focus,
        .form-col select:focus {
            border-color: #667eea;
            outline: none;
        }

        .permissoes-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .permissao-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn-primary,
        .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Quadro de Funcionários */
        .funcionarios-section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .filtros-cracha {
            display: flex;
            gap: 15px;
        }

        .filtros-cracha select {
            padding: 8px 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .funcionarios-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 colunas fixas */
            gap: 20px;
            padding: 20px;
        }

        .cracha-funcionario {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .cracha-funcionario:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .cracha-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .cracha-foto {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .cracha-foto img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cracha-foto i {
            font-size: 24px;
            color: #667eea;
        }

        .cracha-info h4 {
            margin: 0 0 5px 0;
            color: #1e3c72;
            font-size: 16px;
        }

        .cracha-cargo {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .cracha-detalhes {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }

        .cracha-detalhes div {
            margin-bottom: 3px;
        }

        .cracha-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-ativo { background: #28a745; }
        .status-inativo { background: #dc3545; }
        .status-pendente { background: #ffc107; }

        .cracha-permissoes {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }

        .permissao-mini {
            background: #e8f4fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 500;
        }

        /* Redirecionamento da Jornada do Paciente */
        .jornada-paciente-redirect {
            margin-bottom: 30px;
        }

        .redirect-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            color: white;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .redirect-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .redirect-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }

        .redirect-icon {
            font-size: 4em;
            background: rgba(255,255,255,0.2);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }

        .redirect-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .redirect-content h3 {
            font-size: 2em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .redirect-content p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .redirect-features {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .redirect-features span {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .redirect-action {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .btn-access-jornada {
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            margin-bottom: 20px;
        }

        .btn-access-jornada:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .redirect-stats {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .stat-mini {
            text-align: center;
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-mini .stat-number {
            display: block;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-mini .stat-number.urgente {
            color: #ffcccb;
        }

        .stat-mini .stat-label {
            font-size: 0.8em;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-jornada-paciente {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid;
            transition: all 0.3s ease;
            position: relative;
        }

        .card-jornada-paciente:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-jornada-paciente.urgente {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            animation: pulse-urgente 2s infinite;
        }

        .card-jornada-paciente.atencao {
            border-left-color: #ffc107;
            background: linear-gradient(135deg, #fffbf0 0%, #fff3cd 100%);
        }

        .card-jornada-paciente.normal {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #f8fff8 0%, #d4edda 100%);
        }

        @keyframes pulse-urgente {
            0% { box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }
            50% { box-shadow: 0 8px 25px rgba(220, 53, 69, 0.5); }
            100% { box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3); }
        }

        .card-header-jornada {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .paciente-info-jornada h4 {
            margin: 0 0 5px 0;
            color: #1e3c72;
            font-size: 16px;
            font-weight: 600;
        }

        .paciente-info-jornada p {
            margin: 0 0 3px 0;
            color: #666;
            font-size: 12px;
        }

        .status-jornada {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            text-align: center;
            min-width: 80px;
        }

        .status-jornada.confirmar-consulta { background: #ff9800; }
        .status-jornada.enviar-orcamento { background: #2196f3; }
        .status-jornada.aguardar-resposta { background: #9c27b0; }
        .status-jornada.solicitar-exames { background: #f44336; }
        .status-jornada.agendar-cirurgia { background: #4caf50; }
        .status-jornada.preparar-cirurgia { background: #795548; }

        .prazo-info {
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .prazo-info .prazo-label {
            font-weight: 600;
            color: #1e3c72;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .prazo-info .prazo-tempo {
            font-size: 14px;
            font-weight: 700;
        }

        .prazo-info .prazo-tempo.urgente {
            color: #dc3545;
        }

        .prazo-info .prazo-tempo.atencao {
            color: #ff9800;
        }

        .prazo-info .prazo-tempo.normal {
            color: #28a745;
        }

        .acoes-jornada {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn-acao-jornada {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-acao-jornada.confirmar {
            background: #28a745;
            color: white;
        }

        .btn-acao-jornada.enviar {
            background: #2196f3;
            color: white;
        }

        .btn-acao-jornada.anotar {
            background: #ff9800;
            color: white;
        }

        .btn-acao-jornada.visualizar {
            background: #6c757d;
            color: white;
        }

        .observacoes-jornada {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            border-left: 3px solid #667eea;
        }

        .observacoes-jornada h6 {
            margin: 0 0 5px 0;
            color: #1e3c72;
            font-size: 11px;
            font-weight: 600;
        }

        .observacoes-jornada p {
            margin: 0;
            font-size: 11px;
            color: #666;
            line-height: 1.4;
        }

        /* Modal de Configuração */
        .modal-configuracao {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-configuracao.active {
            display: flex;
        }

        .modal-content-configuracao {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .config-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px 15px 0 0;
        }

        .config-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #666;
        }

        .config-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #1e3c72;
        }

        .config-content {
            padding: 30px;
        }

        .config-section {
            display: none;
        }

        .config-section.active {
            display: block;
        }

        .prazo-configuracao {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .prazo-configuracao h4 {
            margin: 0 0 15px 0;
            color: #1e3c72;
            font-size: 16px;
        }

        .prazo-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .prazo-input-group {
            display: flex;
            flex-direction: column;
        }

        .prazo-input-group label {
            font-size: 12px;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .prazo-input-group input,
        .prazo-input-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Pacientes Pendentes */
        .pacientes-pendentes-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .pacientes-pendentes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 colunas fixas */
            gap: 20px;
            padding: 20px;
        }

        .paciente-card {
            background: #fff8e1;
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .paciente-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }

        .paciente-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .paciente-info h4 {
            color: #e65100;
            margin: 0 0 8px 0;
            font-size: 16px;
        }

        .paciente-info p {
            color: #666;
            margin: 0 0 5px 0;
            font-size: 13px;
        }

        .btn-aprovar-paciente {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .btn-rejeitar-paciente {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }

        .btn-aprovar-paciente:hover {
            background: #218838;
        }

        .btn-rejeitar-paciente:hover {
            background: #c82333;
        }

        /* Otimizações para Telas Grandes */
        @media (min-width: 1440px) {
            .admin-container {
                padding: 20px 40px; /* Menos padding para aproveitar melhor o espaço */
            }
            
            .status-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 colunas em telas grandes */
                gap: 25px;
            }
            
            .funcionarios-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 colunas em telas grandes */
                gap: 25px;
            }
            
            .pacientes-pendentes-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 colunas em telas grandes */
                gap: 25px;
            }
        }

        /* Otimizações para Desktop */
        @media (min-width: 1200px) and (max-width: 1439px) {
            .admin-container {
                padding: 20px 30px; /* Otimizado */
            }
            
            .admin-sections {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 40px;
                align-items: start;
            }
            
            .section-funcionarios {
                width: 100%;
            }
            
            .section-sistema {
                position: sticky;
                top: 20px;
            }
            
            .funcionarios-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 colunas em desktop médio */
                gap: 20px;
            }
            
            .status-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 colunas em desktop médio */
                gap: 20px;
            }
            
            .pacientes-pendentes-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 colunas em desktop médio */
                gap: 20px;
            }
            
            .form-grid-cadastro {
                grid-template-columns: 300px 1fr;
                gap: 30px;
                align-items: start;
            }
            
            .redirect-card {
                margin: 20px 0;
                min-height: 200px;
                display: flex;
                align-items: center;
                gap: 30px;
                padding: 30px;
            }
            
            .redirect-content {
                flex: 1;
            }
            
            .section-title h2 {
                font-size: 1.8em;
            }
            
            .admin-header h1 {
                font-size: 2.5em;
            }
            
            .admin-header p {
                font-size: 1.2em;
            }
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .admin-container {
                padding: 15px 20px;
            }
            
            .admin-sections {
                display: block;
            }
            
            .form-grid-cadastro {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .funcionarios-grid {
                grid-template-columns: 1fr;
            }
            
            .pacientes-pendentes-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .filtros-cracha {
                flex-direction: column;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .redirect-card {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .admin-header h1 {
                font-size: 24px;
            }
            
            .admin-header p {
                font-size: 16px;
            }
        }

        @media (min-width: 769px) and (max-width: 1199px) {
            .admin-container {
                padding: 25px 40px;
            }
            
            .admin-sections {
                display: block;
            }
            
            .funcionarios-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            
            .status-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
        }

        /* Modal de detalhes expandido */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content-expandido {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header-expandido {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body-expandido {
            padding: 30px;
        }

        .funcionario-detalhes {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .funcionario-foto-grande {
            text-align: center;
        }

        .funcionario-foto-grande img {
            width: 150px;
            height: 150px;
            border-radius: 15px;
            object-fit: cover;
            border: 4px solid #667eea;
        }

        .funcionario-dados {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .dados-grupo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .dados-grupo h4 {
            margin: 0 0 15px 0;
            color: #1e3c72;
            font-size: 16px;
        }

        .dados-item {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .dados-item strong {
            color: #1e3c72;
            display: inline-block;
            width: 120px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .message {
            margin: 20px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <a href="/dashboard" class="btn-voltar">
                
                Voltar ao Dashboard
            </a>
            <h1> Portal Administrativo Completo</h1>
            <p>Central de Administração - Funcionários, Jornada de Pacientes e Cadastros</p>
        </div>

        <!-- 📑 SEÇÃO 1: Gestão de Funcionários -->
        <div class="section-title">
            <h2> SEÇÃO 1: Gestão de Funcionários</h2>
            <p>Cadastro, controle e gerenciamento de funcionários e sistema de crachás</p>
        </div>

        <div class="admin-sections">
            <div class="section-funcionarios">
                <!-- Área de Cadastro de Funcionário -->
        <div class="cadastro-funcionario-section">
            <div class="section-header">
                <h2> Cadastro de Funcionário</h2>
                <button class="btn-toggle" onclick="toggleCadastroForm()">
                     Novo Funcionário
                </button>
            </div>
            
            <div id="cadastroForm" class="cadastro-form" style="display: none;">
                <form id="formCadastroFuncionario">
                    <div class="form-grid-cadastro">
                        <!-- Área da Foto -->
                        <div class="foto-section">
                            <div class="foto-preview" id="fotoPreview">
                                
                                <span>Adicionar Foto</span>
                                <input type="file" id="fotoFuncionario" accept="image/*" onchange="previewFoto()">
                            </div>
                            <button type="button" class="btn-foto" onclick="document.getElementById('fotoFuncionario').click()">
                                 Selecionar Foto
                            </button>
                        </div>

                        <!-- Formulário Detalhado -->
                        <div class="form-detalhado">
                            <!-- Dados Pessoais -->
                            <div class="dados-pessoais">
                                <h3> Dados Pessoais</h3>
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="nomeCompleto">Nome Completo:</label>
                                        <input type="text" id="nomeCompleto" required placeholder="Nome completo do funcionário">
                                    </div>
                                    <div class="form-col">
                                        <label for="emailFuncionario">Email Corporativo:</label>
                                        <input type="email" id="emailFuncionario" required placeholder="email@clinica.com">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="cpfFuncionario">CPF:</label>
                                        <input type="text" id="cpfFuncionario" required placeholder="000.000.000-00">
                                    </div>
                                    <div class="form-col">
                                        <label for="telefoneFuncionario">Telefone:</label>
                                        <input type="tel" id="telefoneFuncionario" required placeholder="(11) 99999-9999">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Profissionais -->
                            <div class="dados-profissionais">
                                <h3> Dados Profissionais</h3>
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="perfilFuncionario">Perfil/Cargo:</label>
                                        <select id="perfilFuncionario" required onchange="atualizarPermissoesCadastro()">
                                            <option value="">Selecione o cargo</option>
                                            <option value="administrativo">🏢 Administrativo Geral</option>
                                            <option value="atendimento">📞 Atendimento/Recepção</option>
                                            <option value="medico">👨‍⚕️ Médico</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label for="setor">Setor:</label>
                                        <input type="text" id="setor" placeholder="Ex: Recepção, Cirurgia, etc.">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="registro">Registro Profissional:</label>
                                        <input type="text" id="registro" placeholder="CRM, COREN, etc.">
                                    </div>
                                    <div class="form-col">
                                        <label for="especialidade">Especialidade:</label>
                                        <input type="text" id="especialidade" placeholder="Área de especialização">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="dataAdmissao">Data de Admissão:</label>
                                        <input type="date" id="dataAdmissao" required>
                                    </div>
                                    <div class="form-col">
                                        <label for="salario">Salário:</label>
                                        <input type="number" id="salario" step="0.01" placeholder="0.00">
                                    </div>
                                </div>
                            </div>

                            <!-- Permissões -->
                            <div class="permissoes-cadastro">
                                <h3> Permissões do Cargo</h3>
                                <div id="permissoesCadastro" class="permissoes-preview">
                                    <span style="color: #666;">Selecione um cargo para ver as permissões</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="cancelarCadastro()">
                             Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                             Cadastrar Funcionário
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quadro de Funcionários (Crachás) -->
        <div class="funcionarios-section">
            <div class="section-header">
                <h2> Quadro de Funcionários</h2>
                <div class="filtros-cracha">
                    <select id="filtroCargo" onchange="filtrarFuncionarios()">
                        <option value="">Todos os Cargos</option>
                        <option value="administrativo">Administrativo</option>
                        <option value="atendimento">Atendimento</option>
                        <option value="medico">Médico</option>
                    </select>
                    <select id="filtroStatus" onchange="filtrarFuncionarios()">
                        <option value="">Todos os Status</option>
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="pendente">Pendente</option>
                    </select>
                </div>
            </div>

            <div id="funcionariosGrid" class="funcionarios-grid cards-container">
                <!-- Crachás serão carregados dinamicamente -->
                <div class="loading">Carregando funcionários...</div>
            </div>
            </div>

            <div class="section-sistema">
                <!-- Status do Sistema em Tempo Real -->
                <div class="section-title">
                    <h2> Status do Sistema</h2>
                    <p>Informações em tempo real do banco de dados e funcionalidades</p>
                </div>

                <div class="system-status-section">
                    <div class="status-grid cards-container">
                        <div class="status-card">
                            <h4> Banco de Dados</h4>
                            <div id="db-status" class="status-indicator">
                                <span class="status-dot loading"></span>
                                <span>Verificando...</span>
                            </div>
                            <div id="db-stats" class="stats-info"></div>
                        </div>
        </div>

        <hr class="section-separator">

        <!-- 📑 SEÇÃO 2: Gestão da Jornada do Paciente -->
        <div class="section-title">
            <h2> SEÇÃO 2: Gestão da Jornada do Paciente</h2>
            <p>Sistema completo de prazos, notificações e acompanhamento - FUNCIONALIDADE PERFEITA</p>
        </div>

        <!-- Sistema de Gestão da Jornada do Paciente -->
        <div class="jornada-paciente-redirect">
            <div class="redirect-card">
                <div class="redirect-icon">
                    
                </div>
                <div class="redirect-content">
                    <h3>Sistema de Jornada do Paciente</h3>
                    <p>Acesse o sistema completo de gestão da jornada, com prazos, notificações e acompanhamento detalhado de cada paciente.</p>
                    <div class="redirect-features">
                        <span> Gestão de prazos</span>
                        <span> Notificações automáticas</span>
                        <span> Acompanhamento completo</span>
                        <span> Relatórios detalhados</span>
                    </div>
                </div>
                <div class="redirect-action">
                    <a href="jornada-paciente.html" class="btn-access-jornada">
                        
                        Acessar Sistema
                    </a>
                    <div class="redirect-stats">
                        <div class="stat-mini">
                            <span class="stat-number">4</span>
                            <span class="stat-label">Pacientes Ativos</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-number urgente">2</span>
                            <span class="stat-label">Urgentes</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr class="section-separator">

        <!-- � SEÇÃO: Status do Sistema em Tempo Real -->
        <div class="section-title">
            <h2> Status do Sistema</h2>
            <p>Informações em tempo real do banco de dados e funcionalidades</p>
        </div>

        <div class="system-status-section">
            <div class="status-grid cards-container">
                <div class="status-card">
                    <h4> Banco de Dados</h4>
                    <div id="db-status" class="status-indicator">
                        <span class="status-dot loading"></span>
                        <span>Verificando...</span>
                    </div>
                    <div id="db-stats" class="stats-info"></div>
                </div>
                
                <div class="status-card">
                    <h4> Funcionários</h4>
                    <div id="funcionarios-count" class="big-number">-</div>
                    <small>Funcionários ativos</small>
                </div>
                
                <div class="status-card">
                    <h4> Configurações</h4>
                    <div id="configs-count" class="big-number">-</div>
                    <small>Configurações salvas</small>
                </div>
                
                <div class="status-card">
                    <h4> Logs Hoje</h4>
                    <div id="logs-count" class="big-number">-</div>
                    <small>Atividades registradas</small>
                </div>
            </div>
            
            <div class="quick-tests">
                <button class="btn-test" onclick="testarConexaoBanco()">
                     Testar Banco
                </button>
                <button class="btn-test" onclick="verificarPrazosJornada()">
                     Verificar Prazos
                </button>
                <button class="btn-test" onclick="testarNotificacoes()">
                     Testar Notificações
                </button>
            </div>
            
            <div id="test-results" class="test-results" style="display: none;"></div>
                </div>
            </div>
        </div>

        <hr class="section-separator">

        <!-- 📑 SEÇÃO 3: Cadastros Externos Aguardando -->
        <div class="section-title">
            <h2> SEÇÃO 3: Cadastros Externos Aguardando</h2>
            <p>Usuários que se cadastraram pelo site e aguardam classificação como pacientes</p>
        </div>

        <!-- Usuários Externos Aguardando (Pacientes) -->
        <div class="pacientes-pendentes-section">
            <div class="section-header">
                <h2> Cadastros Externos Aguardando</h2>
                <small style="opacity: 0.8;">Usuários que se cadastraram pelo site (serão classificados como pacientes)</small>
            </div>

            <div id="pacientesPendentes" class="pacientes-pendentes-grid">
                <!-- Cards de pacientes pendentes -->
                <div class="loading">Carregando cadastros pendentes...</div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">Carregando...</div>
        <div id="message" class="message"></div>
    </div>

    <!-- Modal de Configuração da Jornada -->
    <div id="modalConfiguracaoJornada" class="modal-configuracao">
        <div class="modal-content-configuracao">
            <div class="config-tabs">
                <div class="config-tab active" onclick="abrirAbaConfig('prazos')">
                     Prazos Automáticos
                </div>
                <div class="config-tab" onclick="abrirAbaConfig('notificacoes')">
                     Notificações
                </div>
                <div class="config-tab" onclick="abrirAbaConfig('templates')">
                     Templates
                </div>
                <div class="config-tab" onclick="abrirAbaConfig('automacao')">
                     Automação
                </div>
            </div>

            <div class="config-content">
                <!-- Configuração de Prazos -->
                <div id="configPrazos" class="config-section active">
                    <div class="modal-header-expandido">
                        <h2> Configuração de Prazos Automáticos</h2>
                        <button class="modal-close" onclick="fecharModalConfiguracao()">&times;</button>
                    </div>

                    <!-- Confirmar Consulta -->
                    <div class="prazo-configuracao">
                        <h4>📅 Confirmação de Consulta</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Prazo para Confirmação:</label>
                                <input type="number" id="prazoConfirmacao" value="24" min="1" max="72">
                                <small>horas antes da consulta</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Método de Contato:</label>
                                <select id="metodoConfirmacao">
                                    <option value="whatsapp">WhatsApp</option>
                                    <option value="sms">SMS</option>
                                    <option value="email">Email</option>
                                    <option value="ligacao">Ligação</option>
                                </select>
                            </div>
                            <div class="prazo-input-group">
                                <label>Tentativas:</label>
                                <input type="number" id="tentativasConfirmacao" value="3" min="1" max="5">
                            </div>
                        </div>
                    </div>

                    <!-- Envio de Orçamento -->
                    <div class="prazo-configuracao">
                        <h4>💰 Envio de Orçamento</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Enviar após consulta:</label>
                                <input type="number" id="prazoOrcamento" value="24" min="1" max="48">
                                <small>horas após a consulta</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Primeiro Lembrete:</label>
                                <input type="number" id="lembreteOrcamento1" value="12" min="1" max="24">
                                <small>horas antes do prazo</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Segundo Lembrete:</label>
                                <input type="number" id="lembreteOrcamento2" value="6" min="1" max="12">
                                <small>horas antes do prazo</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Lembrete Final:</label>
                                <input type="number" id="lembreteOrcamento3" value="3" min="1" max="6">
                                <small>horas antes do prazo</small>
                            </div>
                        </div>
                    </div>

                    <!-- Preparação Cirúrgica -->
                    <div class="prazo-configuracao">
                        <h4>🏥 Preparação Cirúrgica</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Solicitar Exames:</label>
                                <input type="number" id="prazoExames" value="15" min="7" max="30">
                                <small>dias antes da cirurgia</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Avaliar Exames:</label>
                                <input type="number" id="prazoAvaliacaoExames" value="7" min="3" max="14">
                                <small>dias antes da cirurgia</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Solicitar Equipe:</label>
                                <input type="number" id="prazoEquipe" value="10" min="5" max="20">
                                <small>dias antes da cirurgia</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Confirmar Pagamento:</label>
                                <input type="number" id="prazoPagamento" value="5" min="1" max="10">
                                <small>dias antes da cirurgia</small>
                            </div>
                            <div class="prazo-input-group">
                                <label>Solicitar Material:</label>
                                <input type="number" id="prazoMaterial" value="7" min="3" max="15">
                                <small>dias antes da cirurgia</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn-primary" onclick="salvarConfiguracoesPrazos()">
                             Salvar Configurações
                        </button>
                        <button class="btn-secondary" onclick="restaurarPadrao()">
                             Restaurar Padrão
                        </button>
                    </div>
                </div>

                <!-- Configuração de Notificações -->
                <div id="configNotificacoes" class="config-section">
                    <div class="modal-header-expandido">
                        <h2> Configuração de Notificações</h2>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>📱 WhatsApp Business</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Token da API:</label>
                                <input type="text" id="whatsappToken" placeholder="Seu token do WhatsApp Business">
                            </div>
                            <div class="prazo-input-group">
                                <label>Número da Clínica:</label>
                                <input type="text" id="whatsappNumero" placeholder="(11) 99999-9999">
                            </div>
                        </div>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>📧 Email SMTP</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Servidor SMTP:</label>
                                <input type="text" id="smtpServidor" placeholder="smtp.gmail.com">
                            </div>
                            <div class="prazo-input-group">
                                <label>Porta:</label>
                                <input type="number" id="smtpPorta" value="587">
                            </div>
                            <div class="prazo-input-group">
                                <label>Email da Clínica:</label>
                                <input type="email" id="emailClinica" placeholder="contato@clinica.com">
                            </div>
                            <div class="prazo-input-group">
                                <label>Senha do Email:</label>
                                <input type="password" id="senhaEmail" placeholder="Senha do email">
                            </div>
                        </div>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>📲 SMS</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Provedor SMS:</label>
                                <select id="provedorSms">
                                    <option value="twilio">Twilio</option>
                                    <option value="zenvia">Zenvia</option>
                                    <option value="smsdev">SMSDev</option>
                                </select>
                            </div>
                            <div class="prazo-input-group">
                                <label>API Key:</label>
                                <input type="text" id="smsApiKey" placeholder="Sua API Key">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates de Mensagens -->
                <div id="configTemplates" class="config-section">
                    <div class="modal-header-expandido">
                        <h2> Templates de Mensagens</h2>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>Confirmação de Consulta</h4>
                        <textarea id="templateConfirmacao" rows="4" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
Olá {NOME}! 

Sua consulta está agendada para {DATA} às {HORA}.

Por favor, confirme sua presença respondendo este mensagem com SIM.

Dr. Marcio Scartozzoni
                        </textarea>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>Envio de Orçamento</h4>
                        <textarea id="templateOrcamento" rows="4" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
Olá {NOME}!

Segue o orçamento conforme conversamos na consulta.

{LINK_ORCAMENTO}

Qualquer dúvida, estou à disposição!

Dr. Marcio Scartozzoni
                        </textarea>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>Lembrete de Exames</h4>
                        <textarea id="templateExames" rows="4" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px;">
Olá {NOME}!

Para sua cirurgia em {DATA_CIRURGIA}, precisamos que realize os seguintes exames:

{LISTA_EXAMES}

Prazo limite: {PRAZO}

Dr. Marcio Scartozzoni
                        </textarea>
                    </div>
                </div>

                <!-- Automação -->
                <div id="configAutomacao" class="config-section">
                    <div class="modal-header-expandido">
                        <h2> Configuração de Automação</h2>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>🕐 Horários de Verificação</h4>
                        <div class="prazo-inputs">
                            <div class="prazo-input-group">
                                <label>Verificação Manhã:</label>
                                <input type="time" id="horarioManha" value="08:00">
                            </div>
                            <div class="prazo-input-group">
                                <label>Verificação Tarde:</label>
                                <input type="time" id="horarioTarde" value="14:00">
                            </div>
                            <div class="prazo-input-group">
                                <label>Dias da Semana:</label>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <label><input type="checkbox" checked> Segunda</label>
                                    <label><input type="checkbox" checked> Terça</label>
                                    <label><input type="checkbox" checked> Quarta</label>
                                    <label><input type="checkbox" checked> Quinta</label>
                                    <label><input type="checkbox" checked> Sexta</label>
                                    <label><input type="checkbox"> Sábado</label>
                                    <label><input type="checkbox"> Domingo</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="prazo-configuracao">
                        <h4>🎯 Ações Automáticas</h4>
                        <div style="display: grid; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoConfirmacao" checked>
                                Enviar automaticamente lembrete de confirmação
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoOrcamento" checked>
                                Criar card de orçamento após consulta
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoExames" checked>
                                Criar card de exames após aceite do orçamento
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoEquipe" checked>
                                Notificar equipe médica automaticamente
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="autoMaterial" checked>
                                Criar solicitação de material automaticamente
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Painel de Notificações -->
    <div id="modalPainelNotificacoes" class="modal-configuracao">
        <div class="modal-content-configuracao">
            <div class="modal-header-expandido">
                <h2> Painel de Notificações e Controle</h2>
                <button class="modal-close" onclick="fecharModalNotificacoes()">&times;</button>
            </div>
            
            <div class="config-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; justify-content: center; max-width: 1200px; margin: 0 auto;">
                    <!-- Notificações Pendentes -->
                    <div>
                        <h3> Notificações Pendentes</h3>
                        <div id="notificacoesPendentes" style="max-height: 400px; overflow-y: auto;">
                            <!-- Lista de notificações -->
                        </div>
                    </div>

                    <!-- Log de Envios -->
                    <div>
                        <h3> Log de Envios</h3>
                        <div id="logEnvios" style="max-height: 400px; overflow-y: auto;">
                            <!-- Log de envios -->
                        </div>
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 30px;">
                    <button class="btn-primary" onclick="enviarTodasNotificacoes()">
                         Enviar Todas
                    </button>
                    <button class="btn-secondary" onclick="limparLog()">
                         Limpar Log
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Funcionário -->
    <div id="modalFuncionario" class="modal-overlay" style="display: none;">
        <div class="modal-content-expandido">
            <div class="modal-header-expandido">
                <h2> Detalhes do Funcionário</h2>
                <button class="modal-close" onclick="fecharModalFuncionario()">&times;</button>
            </div>
            
            <div class="modal-body-expandido">
                <div class="funcionario-detalhes">
                    <div class="funcionario-foto-grande">
                        <img id="modalFoto" src="" alt="Foto do funcionário" style="display: none;">
                        <div id="modalFotoPlaceholder" style="width: 150px; height: 150px; background: #f0f0f0; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            
                        </div>
                        <button class="btn-foto" style="margin-top: 15px;" onclick="alterarFoto()">
                             Alterar Foto
                        </button>
                    </div>

                    <div class="funcionario-dados">
                        <div class="dados-grupo">
                            <h4> Dados Pessoais</h4>
                            <div class="dados-item">
                                <strong>Nome:</strong> <span id="modalNome">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Email:</strong> <span id="modalEmail">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>CPF:</strong> <span id="modalCpf">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Telefone:</strong> <span id="modalTelefone">-</span>
                            </div>
                        </div>

                        <div class="dados-grupo">
                            <h4> Dados Profissionais</h4>
                            <div class="dados-item">
                                <strong>Cargo:</strong> <span id="modalCargo">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Setor:</strong> <span id="modalSetor">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Registro:</strong> <span id="modalRegistro">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Especialidade:</strong> <span id="modalEspecialidade">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Admissão:</strong> <span id="modalAdmissao">-</span>
                            </div>
                        </div>

                        <div class="dados-grupo" style="grid-column: 1 / -1;">
                            <h4> Permissões Atuais</h4>
                            <div id="modalPermissoes" class="permissoes-preview">
                                <!-- Permissões serão carregadas -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-secondary" onclick="editarFuncionario()">
                         Editar
                    </button>
                    <button class="btn-primary" onclick="alterarPermissoes()">
                         Alterar Permissões
                    </button>
                    <button class="btn-secondary" onclick="fecharModalFuncionario()">
                         Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let funcionarios = [];
        let pacientesPendentes = [];
        let jornadaPacientes = [];
        let configuracoesPrazos = {};
        let notificacoesPendentes = [];

        // Dados de exemplo para jornada de pacientes
        const jornadaExemplo = [
            {
                id: 1,
                paciente: {
                    nome: "Maria Silva",
                    telefone: "(11) 99999-1111",
                    email: "maria@email.com"
                },
                etapaAtual: "confirmar-consulta",
                consulta: {
                    data: new Date(Date.now() + 20 * 60 * 60 * 1000), // 20 horas no futuro
                    confirmada: false
                },
                orcamento: null,
                cirurgia: null,
                observacoes: "Paciente interessada em rinoplastia. Primeira consulta agendada.",
                prioridade: "urgente",
                proximaAcao: "Confirmar consulta até amanhã 14h",
                prazo: new Date(Date.now() + 20 * 60 * 60 * 1000)
            },
            {
                id: 2,
                paciente: {
                    nome: "Ana Costa",
                    telefone: "(11) 88888-2222",
                    email: "ana@email.com"
                },
                etapaAtual: "enviar-orcamento",
                consulta: {
                    data: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 horas atrás
                    confirmada: true,
                    realizada: true
                },
                orcamento: {
                    valor: 15000,
                    enviado: false
                },
                cirurgia: null,
                observacoes: "Consulta realizada. Paciente aprovou procedimento de mamoplastia. Enviar orçamento urgente.",
                prioridade: "atencao",
                proximaAcao: "Enviar orçamento nas próximas 22 horas",
                prazo: new Date(Date.now() + 22 * 60 * 60 * 1000)
            },
            {
                id: 3,
                paciente: {
                    nome: "João Santos",
                    telefone: "(11) 77777-3333",
                    email: "joao@email.com"
                },
                etapaAtual: "solicitar-exames",
                consulta: {
                    data: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000), // 10 dias atrás
                    confirmada: true,
                    realizada: true
                },
                orcamento: {
                    valor: 12000,
                    enviado: true,
                    aceito: true,
                    dataAceite: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000)
                },
                cirurgia: {
                    data: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000), // 10 dias no futuro
                    confirmada: true
                },
                observacoes: "Cirurgia agendada para 10 dias. Solicitar exames pré-operatórios urgente.",
                prioridade: "urgente",
                proximaAcao: "Solicitar exames pré-operatórios",
                prazo: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000)
            }
        ];

        // Configurações padrão de prazos
        const configuracoesPadrao = {
            confirmacao: {
                prazo: 24, // horas
                metodo: "whatsapp",
                tentativas: 3
            },
            orcamento: {
                prazo: 24, // horas após consulta
                lembretes: [12, 6, 3] // horas antes do prazo
            },
            cirurgia: {
                exames: 15, // dias antes
                avaliacaoExames: 7, // dias antes
                equipe: 10, // dias antes
                pagamento: 5, // dias antes
                material: 7 // dias antes
            },
            horarios: {
                manha: "08:00",
                tarde: "14:00"
            }
        };

        // Dados de exemplo
        const funcionariosExemplo = [
            {
                id: 1,
                nome: "Dr. Marcio Scartozzoni",
                email: "marcio@clinica.com",
                cargo: "medico",
                setor: "Cirurgia Plástica",
                foto: null,
                status: "ativo",
                registro: "CRM 123456",
                especialidade: "Cirurgia Plástica",
                telefone: "(11) 99999-9999",
                cpf: "123.456.789-00",
                admissao: "2020-01-15",
                permissoes: ["dashboard", "agendamento", "quadro-evolutivo", "caderno-digital", "prontuarios", "prescricoes", "laudos"]
            },
            {
                id: 2,
                nome: "Ana Paula Silva",
                email: "ana@clinica.com",
                cargo: "atendimento",
                setor: "Recepção",
                foto: null,
                status: "ativo",
                registro: null,
                especialidade: null,
                telefone: "(11) 88888-8888",
                cpf: "987.654.321-00",
                admissao: "2022-03-10",
                permissoes: ["dashboard", "agendamento", "gestao-pacientes", "criar-agendamento"]
            },
            {
                id: 3,
                nome: "Carlos Santos",
                email: "carlos@clinica.com",
                cargo: "administrativo",
                setor: "Administração",
                foto: null,
                status: "ativo",
                registro: null,
                especialidade: null,
                telefone: "(11) 77777-7777",
                cpf: "456.789.123-00",
                admissao: "2021-06-20",
                permissoes: ["dashboard", "agendamento", "gestao-pacientes", "relatorios", "financeiro", "usuarios"]
            }
        ];

        const pacientesExemplo = [
            {
                id: 1,
                nome: "Maria Silva",
                email: "maria@email.com",
                telefone: "(11) 99999-1111",
                dataCadastro: "2025-07-29"
            },
            {
                id: 2,
                nome: "João Santos",
                email: "joao@email.com",
                telefone: "(11) 99999-2222",
                dataCadastro: "2025-07-30"
            }
        ];

        // Inicializar página
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação
            const userInfo = localStorage.getItem('userInfo');
            if (!userInfo) {
                window.location.href = '/login.html';
                return;
            }

            const user = JSON.parse(userInfo);
            console.log('👤 Usuário verificado:', user);
            
            // CORREÇÃO: verificar tanto 'role' quanto 'tipo' para admin
            const isAdmin = user.role === 'admin' || user.tipo === 'admin';
            
            if (!isAdmin) {
                alert('Acesso negado. Apenas administradores podem acessar esta página.');
                window.location.href = '/dashboard.html';
                return;
            }
            
            console.log('✅ Acesso liberado para admin:', user.email);

            // Carregar dados
            carregarFuncionarios();
            carregarPacientesPendentes();
            // Jornada de pacientes movida para página dedicada
            carregarConfiguracoesPrazos();
            iniciarVerificacaoAutomatica();

            // Definir data mínima para admissão
            document.getElementById('dataAdmissao').value = new Date().toISOString().split('T')[0];
        });

        // Toggle do formulário de cadastro
        function toggleCadastroForm() {
            const form = document.getElementById('cadastroForm');
            const isVisible = form.style.display !== 'none';
            form.style.display = isVisible ? 'none' : 'block';
            
            const btn = document.querySelector('.btn-toggle');
            btn.innerHTML = isVisible ? 
                ' Novo Funcionário' : 
                ' Fechar Formulário';
        }

        // Preview da foto
        function previewFoto() {
            const input = document.getElementById('fotoFuncionario');
            const preview = document.getElementById('fotoPreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Atualizar permissões do cadastro
        function atualizarPermissoesCadastro() {
            const perfil = document.getElementById('perfilFuncionario').value;
            const container = document.getElementById('permissoesCadastro');
            
            const permissoesPorPerfil = {
                'administrativo': ['Dashboard', 'Agendamentos', 'Gestão Pacientes', 'Relatórios', 'Financeiro', 'Usuários'],
                'atendimento': ['Dashboard', 'Agendamentos', 'Gestão Pacientes', 'Criar Agendamentos'],
                'medico': ['Dashboard', 'Agendamentos', 'Quadro Evolutivo', 'Caderno Digital', 'Prontuários', 'Prescrições', 'Laudos']
            };
            
            if (perfil && permissoesPorPerfil[perfil]) {
                container.innerHTML = permissoesPorPerfil[perfil]
                    .map(perm => `<span class="permissao-tag">${perm}</span>`)
                    .join('');
            } else {
                container.innerHTML = '<span style="color: #666;">Selecione um cargo para ver as permissões</span>';
            }
        }

        // Cancelar cadastro
        function cancelarCadastro() {
            document.getElementById('formCadastroFuncionario').reset();
            document.getElementById('fotoPreview').innerHTML = `
                
                <span>Adicionar Foto</span>
                <input type="file" id="fotoFuncionario" accept="image/*" onchange="previewFoto()">
            `;
            toggleCadastroForm();
        }

        // Submeter cadastro de funcionário
        document.getElementById('formCadastroFuncionario').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                nome: document.getElementById('nomeCompleto').value,
                email: document.getElementById('emailFuncionario').value,
                cpf: document.getElementById('cpfFuncionario').value,
                telefone: document.getElementById('telefoneFuncionario').value,
                cargo: document.getElementById('perfilFuncionario').value,
                setor: document.getElementById('setor').value,
                registro: document.getElementById('registro').value,
                especialidade: document.getElementById('especialidade').value,
                admissao: document.getElementById('dataAdmissao').value,
                salario: document.getElementById('salario').value
            };
            
            // Mapear cargo para tipo de usuário
            const tipoMap = {
                'administrativo': 'staff',
                'atendimento': 'recepcionista',
                'medico': 'medico'
            };
            
            const dadosCadastro = {
                email: formData.email,
                nome: formData.nome,
                telefone: formData.telefone,
                tipo: tipoMap[formData.cargo] || 'funcionario'
            };
            
            try {
                // Enviar para API de cadastro
                const response = await fetch('/api/cadastrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosCadastro)
                });
                
                const data = await response.json();
                
                if (data.sucesso) {
                    // Auto-aprovar funcionários cadastrados pelo admin
                    const approveResponse = await fetch('/api/aprovar-usuario', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: formData.email,
                            aprovadorEmail: 'admin@drmarcio.com'
                        })
                    });
                    
                    const approveData = await approveResponse.json();
                    
                    if (approveData.sucesso) {
                        alert(`✅ Funcionário cadastrado e aprovado com sucesso!

📧 Email: ${formData.email}
👤 Nome: ${formData.nome}
🏢 Cargo: ${formData.cargo}
🔐 Código de Acesso: ${approveData.codigoAcesso}

O funcionário deve acessar o sistema e criar sua senha usando o código fornecido.`);
                        
                        // Recarregar lista de funcionários
                        carregarFuncionarios();
                        cancelarCadastro();
                    } else {
                        alert('❌ Erro ao aprovar funcionário: ' + (approveData.message || approveData.erro));
                    }
                } else {
                    alert('❌ Erro ao cadastrar funcionário: ' + (data.message || data.erro));
                }
            } catch (error) {
                console.error('Erro ao cadastrar funcionário:', error);
                alert('❌ Erro de conexão. Tente novamente.');
            }
        });

        // Gerar senha provisória
        function gerarSenhaProvisoria() {
            return Math.random().toString(36).slice(-8);
        }

        // Obter permissões por cargo
        function getPermissoesPorCargo(cargo) {
            const permissoes = {
                'administrativo': ['dashboard', 'agendamento', 'gestao-pacientes', 'relatorios', 'financeiro', 'usuarios'],
                'atendimento': ['dashboard', 'agendamento', 'gestao-pacientes', 'criar-agendamento'],
                'medico': ['dashboard', 'agendamento', 'quadro-evolutivo', 'caderno-digital', 'prontuarios', 'prescricoes', 'laudos']
            };
            return permissoes[cargo] || ['dashboard'];
        }

        // Carregar funcionários
        function carregarFuncionarios() {
            const grid = document.getElementById('funcionariosGrid');
            
            if (funcionarios.length === 0) {
                funcionarios = [...funcionariosExemplo];
            }
            
            grid.innerHTML = funcionarios.map(func => `
                <div class="cracha-funcionario" onclick="abrirModalFuncionario(${func.id})">
                    <div class="cracha-status status-${func.status}"></div>
                    <div class="cracha-header">
                        <div class="cracha-foto">
                            ${func.foto ? 
                                `<img src="${func.foto}" alt="${func.nome}">` : 
                                ''
                            }
                        </div>
                        <div class="cracha-info">
                            <h4>${func.nome}</h4>
                            <div class="cracha-cargo">${getCargoTexto(func.cargo)}</div>
                        </div>
                    </div>
                    <div class="cracha-detalhes">
                        <div> ${func.email}</div>
                        <div> ${func.setor}</div>
                        ${func.registro ? `<div> ${func.registro}</div>` : ''}
                    </div>
                    <div class="cracha-permissoes">
                        ${func.permissoes.slice(0, 3).map(perm => 
                            `<span class="permissao-mini">${perm}</span>`
                        ).join('')}
                        ${func.permissoes.length > 3 ? 
                            `<span class="permissao-mini">+${func.permissoes.length - 3}</span>` : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }

        // ============ JORNADA DO PACIENTE MOVIDA ============
        // As funções da Jornada do Paciente foram movidas para jornada-paciente.html
        // para melhor organização e performance do sistema

        // ============ CONFIGURAÇÕES ============

        function carregarConfiguracoesPrazos() {
            const saved = localStorage.getItem('configuracoesPrazos');
            configuracoesPrazos = saved ? JSON.parse(saved) : configuracoesPadrao;
            
            // Configurações mantidas para compatibilidade do sistema
            console.log('Configurações de prazos carregadas');
        }

        function salvarConfiguracoesPrazos() {
            configuracoesPrazos = {
                confirmacao: {
                    prazo: 24,
                    metodo: 'whatsapp',
                    tentativas: 3
                },
                orcamento: {
                    prazo: 48,
                    lembretes: [24, 48, 72]
                },
                cirurgia: {
                    exames: 7,
                    avaliacaoExames: 3,
                    equipe: 1,
                    pagamento: 1,
                    material: 1
                }
            };
            
            localStorage.setItem('configuracoesPrazos', JSON.stringify(configuracoesPrazos));
            console.log('Configurações salvas');
        }

        // ============ VERIFICAÇÃO AUTOMÁTICA ============

        function executarVerificacaoPrazos() {
            console.log('🕐 Executando verificação de prazos...');
            
            let notificacoesGeradas = 0;
            const agora = new Date();
            
            jornadaPacientes.forEach(jornada => {
                const tempoRestante = jornada.prazo - agora;
                const horasRestantes = tempoRestante / (1000 * 60 * 60);
                
                // Verificar se precisa gerar notificação
                if (horasRestantes <= 24 && horasRestantes > 0) {
                    // Gerar notificação de atenção
                    gerarNotificacao(jornada, 'atencao');
                    notificacoesGeradas++;
                } else if (horasRestantes <= 0) {
                    // Gerar notificação urgente
                    gerarNotificacao(jornada, 'urgente');
                    jornada.prioridade = 'urgente';
                    notificacoesGeradas++;
                }
            });
            
            if (notificacoesGeradas > 0) {
                salvarJornadaPacientes();
                carregarJornadaPacientes();
                alert(`⚠️ ${notificacoesGeradas} notificação(ões) gerada(s)!\n\nVerifique o painel de notificações.`);
            } else {
                alert('✅ Nenhuma notificação pendente no momento.');
            }
        }

        function iniciarVerificacaoAutomatica() {
            // Verificar a cada 30 minutos
            setInterval(() => {
                executarVerificacaoPrazos();
            }, 30 * 60 * 1000);
            
            console.log('🤖 Verificação automática iniciada (a cada 30 minutos)');
        }

        function gerarNotificacao(jornada, tipo) {
            const notificacao = {
                id: Date.now(),
                pacienteId: jornada.id,
                pacienteNome: jornada.paciente.nome,
                tipo: tipo,
                etapa: jornada.etapaAtual,
                mensagem: `${jornada.proximaAcao} - ${jornada.paciente.nome}`,
                timestamp: new Date(),
                enviada: false
            };
            
            notificacoesPendentes.push(notificacao);
            localStorage.setItem('notificacoesPendentes', JSON.stringify(notificacoesPendentes));
        }

        function carregarNotificacoesPendentes() {
            const container = document.getElementById('notificacoesPendentes');
            const saved = localStorage.getItem('notificacoesPendentes');
            notificacoesPendentes = saved ? JSON.parse(saved) : [];
            
            if (notificacoesPendentes.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Nenhuma notificação pendente</div>';
                return;
            }
            
            container.innerHTML = notificacoesPendentes.map(notif => `
                <div class="notification ${notif.tipo}" style="margin-bottom: 10px;">
                    <div class="notification-text">
                        <strong>${notif.pacienteNome}</strong><br>
                        ${notif.mensagem}<br>
                        <small>${new Date(notif.timestamp).toLocaleString('pt-BR')}</small>
                    </div>
                    <button onclick="enviarNotificacaoManual(${notif.id})" class="btn-acao-jornada enviar">
                        
                    </button>
                </div>
            `).join('');
        }

        function carregarLogEnvios() {
            const container = document.getElementById('logEnvios');
            const saved = localStorage.getItem('logEnvios');
            const log = saved ? JSON.parse(saved) : [];
            
            if (log.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">Nenhum envio registrado</div>';
                return;
            }
            
            container.innerHTML = log.slice(-20).reverse().map(item => `
                <div style="padding: 10px; border-bottom: 1px solid #eee; font-size: 12px;">
                    <strong>${item.paciente}</strong> - ${item.tipo}<br>
                    <span style="color: #666;">${new Date(item.timestamp).toLocaleString('pt-BR')}</span><br>
                    <span style="color: ${item.sucesso ? '#28a745' : '#dc3545'};">
                        ${item.sucesso ? '✅ Enviado' : '❌ Falha'}
                    </span>
                </div>
            `).join('');
        }

        function enviarNotificacaoManual(id) {
            const notificacao = notificacoesPendentes.find(n => n.id === id);
            if (!notificacao) return;
            
            // Simular envio
            const sucesso = confirm(`Enviar notificação para ${notificacao.pacienteNome}?\n\n${notificacao.mensagem}`);
            
            if (sucesso) {
                // Registrar no log
                registrarEnvio(notificacao.pacienteNome, notificacao.tipo, true);
                
                // Remover da lista de pendentes
                notificacoesPendentes = notificacoesPendentes.filter(n => n.id !== id);
                localStorage.setItem('notificacoesPendentes', JSON.stringify(notificacoesPendentes));
                
                carregarNotificacoesPendentes();
                carregarLogEnvios();
                
                alert('✅ Notificação enviada com sucesso!');
            }
        }

        function enviarTodasNotificacoes() {
            if (notificacoesPendentes.length === 0) {
                alert('Nenhuma notificação pendente para enviar.');
                return;
            }
            
            if (confirm(`Enviar todas as ${notificacoesPendentes.length} notificações pendentes?`)) {
                notificacoesPendentes.forEach(notif => {
                    registrarEnvio(notif.pacienteNome, notif.tipo, true);
                });
                
                notificacoesPendentes = [];
                localStorage.setItem('notificacoesPendentes', JSON.stringify(notificacoesPendentes));
                
                carregarNotificacoesPendentes();
                carregarLogEnvios();
                
                alert('✅ Todas as notificações foram enviadas!');
            }
        }

        function registrarEnvio(paciente, tipo, sucesso) {
            const saved = localStorage.getItem('logEnvios');
            const log = saved ? JSON.parse(saved) : [];
            
            log.push({
                paciente: paciente,
                tipo: tipo,
                sucesso: sucesso,
                timestamp: new Date().toISOString()
            });
            
            // Manter apenas os últimos 100 registros
            if (log.length > 100) {
                log.splice(0, log.length - 100);
            }
            
            localStorage.setItem('logEnvios', JSON.stringify(log));
        }

        function limparLog() {
            if (confirm('Limpar todo o log de envios?')) {
                localStorage.removeItem('logEnvios');
                carregarLogEnvios();
                alert('✅ Log limpo com sucesso!');
            }
        }

        // ============ FUNÇÕES AUXILIARES ============

        function programarEtapa(jornadaId, etapa, prazo) {
            // Esta função seria usada para programar etapas futuras
            console.log(`Programando etapa "${etapa}" para jornada ${jornadaId} em ${prazo}`);
        }

        function enviarNotificacao(paciente, tipo, dados = {}) {
            // Esta função integraria com APIs de WhatsApp, SMS, Email
            console.log(`Enviando notificação ${tipo} para ${paciente.nome}`, dados);
            
            // Registrar no log
            registrarEnvio(paciente.nome, tipo, true);
        }

        function salvarJornadaPacientes() {
            localStorage.setItem('jornadaPacientes', JSON.stringify(jornadaPacientes));
        }

        // Carregar pacientes pendentes
        async function carregarPacientesPendentes() {
            const grid = document.getElementById('pacientesPendentes');
            
            try {
                grid.innerHTML = '<div class="loading">Carregando usuários pendentes...</div>';
                
                // Buscar usuários pendentes na API
                const response = await fetch('/api/usuarios-pendentes');
                const data = await response.json();
                
                if (data.sucesso && data.usuarios.length > 0) {
                    grid.innerHTML = data.usuarios.map(usuario => `
                        <div class="paciente-card">
                            <div class="paciente-header">
                                <div class="paciente-info">
                                    <h4>${usuario.nome}</h4>
                                    <p> ${usuario.email}</p>
                                    <p> ${usuario.telefone || 'Não informado'}</p>
                                    <p> Tipo: ${usuario.tipo}</p>
                                    <p> ${new Date(usuario.created_at).toLocaleDateString('pt-BR')}</p>
                                    <p> Status: ${usuario.status_aprovacao}</p>
                                </div>
                                <div class="paciente-actions">
                                    <button class="btn-aprovar-paciente" onclick="aprovarUsuario('${usuario.email}')">
                                         Aprovar
                                    </button>
                                    <button class="btn-rejeitar-paciente" onclick="rejeitarUsuario('${usuario.email}')" style="background: #dc3545; margin-top: 5px;">
                                         Rejeitar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<div class="empty-state">✅ Nenhum usuário pendente de aprovação</div>';
                }
            } catch (error) {
                console.error('Erro ao carregar usuários pendentes:', error);
                grid.innerHTML = '<div class="error">❌ Erro ao carregar usuários pendentes</div>';
            }
        }

        // Aprovar paciente
        // Aprovar usuário
        async function aprovarUsuario(email) {
            if (!confirm(`Aprovar usuário com email "${email}"?`)) return;
            
            try {
                const response = await fetch('/api/aprovar-usuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        aprovadorEmail: 'admin@drmarcio.com'
                    })
                });
                
                const data = await response.json();
                
                if (data.sucesso) {
                    alert(`✅ Usuário aprovado com sucesso!\n\nCódigo de acesso: ${data.codigoAcesso}`);
                    carregarPacientesPendentes(); // Recarregar lista
                } else {
                    alert('❌ Erro ao aprovar usuário: ' + (data.message || data.erro));
                }
            } catch (error) {
                console.error('Erro ao aprovar usuário:', error);
                alert('❌ Erro de conexão. Tente novamente.');
            }
        }
        
        // Rejeitar usuário
        async function rejeitarUsuario(email) {
            const motivo = prompt(`Motivo da rejeição para "${email}":`);
            if (!motivo) return;
            
            try {
                const response = await fetch('/api/rejeitar-usuario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        motivo: motivo
                    })
                });
                
                const data = await response.json();
                
                if (data.sucesso) {
                    alert(`✅ Usuário rejeitado.`);
                    carregarPacientesPendentes(); // Recarregar lista
                } else {
                    alert('❌ Erro ao rejeitar usuário: ' + (data.message || data.erro));
                }
            } catch (error) {
                console.error('Erro ao rejeitar usuário:', error);
                alert('❌ Erro de conexão. Tente novamente.');
            }
        }

        // Função legada - manter para compatibilidade
        function aprovarPaciente(id) {
            console.log('Função legada aprovarPaciente chamada com ID:', id);
            alert('Esta função foi substituída pelas novas funções de aprovação.');
        }

        // Obter texto do cargo
        function getCargoTexto(cargo) {
            const cargos = {
                'administrativo': 'Administrativo',
                'atendimento': 'Atendimento',
                'medico': 'Médico'
            };
            return cargos[cargo] || cargo;
        }

        // Abrir modal do funcionário
        function abrirModalFuncionario(id) {
            const funcionario = funcionarios.find(f => f.id === id);
            if (!funcionario) return;
            
            // Preencher dados no modal
            document.getElementById('modalNome').textContent = funcionario.nome;
            document.getElementById('modalEmail').textContent = funcionario.email;
            document.getElementById('modalCpf').textContent = funcionario.cpf;
            document.getElementById('modalTelefone').textContent = funcionario.telefone;
            document.getElementById('modalCargo').textContent = getCargoTexto(funcionario.cargo);
            document.getElementById('modalSetor').textContent = funcionario.setor || '-';
            document.getElementById('modalRegistro').textContent = funcionario.registro || '-';
            document.getElementById('modalEspecialidade').textContent = funcionario.especialidade || '-';
            document.getElementById('modalAdmissao').textContent = new Date(funcionario.admissao).toLocaleDateString('pt-BR');
            
            // Foto
            if (funcionario.foto) {
                document.getElementById('modalFoto').src = funcionario.foto;
                document.getElementById('modalFoto').style.display = 'block';
                document.getElementById('modalFotoPlaceholder').style.display = 'none';
            } else {
                document.getElementById('modalFoto').style.display = 'none';
                document.getElementById('modalFotoPlaceholder').style.display = 'flex';
            }
            
            // Permissões
            const permissoesContainer = document.getElementById('modalPermissoes');
            permissoesContainer.innerHTML = funcionario.permissoes
                .map(perm => `<span class="permissao-tag">${perm}</span>`)
                .join('');
            
            // Mostrar modal
            document.getElementById('modalFuncionario').style.display = 'flex';
            window.currentFuncionario = funcionario;
        }

        // Fechar modal
        function fecharModalFuncionario() {
            document.getElementById('modalFuncionario').style.display = 'none';
            window.currentFuncionario = null;
        }

        // Funções do modal (placeholder)
        function alterarFoto() {
            alert('🚧 Funcionalidade de alterar foto em desenvolvimento');
        }

        function editarFuncionario() {
            alert('🚧 Funcionalidade de edição em desenvolvimento');
        }

        function alterarPermissoes() {
            alert('🚧 Funcionalidade de alterar permissões em desenvolvimento');
        }

        // Filtrar funcionários
        function filtrarFuncionarios() {
            const filtroCargo = document.getElementById('filtroCargo').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            
            // TODO: Implementar filtros
            console.log('Filtros:', { cargo: filtroCargo, status: filtroStatus });
        }

        // Script para scroll automático para seção da jornada
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se há hash na URL para scroll automático
            if (window.location.hash === '#jornada-paciente') {
                setTimeout(() => {
                    const elemento = document.getElementById('jornada-paciente');
                    if (elemento) {
                        elemento.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                        // Destacar temporariamente a seção
                        elemento.style.boxShadow = '0 0 20px rgba(255, 107, 107, 0.5)';
                        setTimeout(() => {
                            elemento.style.boxShadow = '';
                        }, 3000);
                    }
                }, 500);
            }
            
            // Inicializar status do sistema
            verificarStatusSistema();
            
            // Atualizar status a cada 30 segundos
            setInterval(verificarStatusSistema, 30000);
        });
        
        // Verificar status do sistema em tempo real
        async function verificarStatusSistema() {
            try {
                const response = await fetch('/api/system/status');
                const data = await response.json();
                
                if (data.success) {
                    // Atualizar indicador de banco
                    const dbStatus = document.getElementById('db-status');
                    dbStatus.innerHTML = `
                        <span class="status-dot online"></span>
                        <span>Conectado</span>
                    `;
                    
                    // Atualizar estatísticas
                    document.getElementById('funcionarios-count').textContent = data.sistema.funcionarios_ativos;
                    document.getElementById('configs-count').textContent = data.sistema.configuracoes;
                    document.getElementById('logs-count').textContent = data.sistema.logs_hoje;
                    
                    // Atualizar informações do banco
                    const dbStats = document.getElementById('db-stats');
                    dbStats.innerHTML = `
                        <div>✅ PostgreSQL ativo</div>
                        <div>🚀 ${data.apis_disponiveis.length} APIs disponíveis</div>
                    `;
                } else {
                    // Erro na conexão
                    document.getElementById('db-status').innerHTML = `
                        <span class="status-dot offline"></span>
                        <span>Desconectado</span>
                    `;
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
                document.getElementById('db-status').innerHTML = `
                    <span class="status-dot offline"></span>
                    <span>Erro de conexão</span>
                `;
            }
        }
        
        // Testar conexão com banco
        async function testarConexaoBanco() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = ' Testando conexão...';
            
            try {
                const response = await fetch('/api/system/database-info');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-results test-success';
                    resultDiv.innerHTML = `
                        <h4>✅ Teste de Banco - SUCESSO</h4>
                        <p><strong>Status:</strong> ${data.database.status}</p>
                        <p><strong>Total de Tabelas:</strong> ${data.database.total_tabelas}</p>
                        <p><strong>Tabelas principais:</strong> ${data.tabelas.map(t => t.table_name).join(', ')}</p>
                    `;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                resultDiv.className = 'test-results test-error';
                resultDiv.innerHTML = `
                    <h4>❌ Teste de Banco - FALHOU</h4>
                    <p>Erro: ${error.message}</p>
                `;
            }
        }
        
        // Verificar prazos da jornada
        async function verificarPrazosJornada() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = ' Verificando prazos...';
            
            try {
                const [prazosResponse, verificacaoResponse] = await Promise.all([
                    fetch('/api/jornada/prazos'),
                    fetch('/api/jornada/verificar-prazos')
                ]);
                
                const prazosData = await prazosResponse.json();
                const verificacaoData = await verificacaoResponse.json();
                
                if (prazosData.success && verificacaoData.success) {
                    resultDiv.className = 'test-results test-success';
                    resultDiv.innerHTML = `
                        <h4>✅ Verificação de Prazos - SUCESSO</h4>
                        <p><strong>Prazos configurados:</strong></p>
                        <ul>
                            <li>Primeira consulta: ${prazosData.prazos.prazo_primeira_consulta || 0} dias</li>
                            <li>Retorno: ${prazosData.prazos.prazo_retorno || 0} dias</li>
                            <li>Exames: ${prazosData.prazos.prazo_exames || 0} dias</li>
                            <li>Urgência: ${prazosData.prazos.prazo_urgencia || 0} dias</li>
                        </ul>
                        <p><strong>Prazos vencidos:</strong> ${verificacaoData.total}</p>
                    `;
                } else {
                    throw new Error('Erro ao verificar prazos');
                }
            } catch (error) {
                resultDiv.className = 'test-results test-error';
                resultDiv.innerHTML = `
                    <h4>❌ Verificação de Prazos - FALHOU</h4>
                    <p>Erro: ${error.message}</p>
                `;
            }
        }
        
        // Testar sistema de notificações
        async function testarNotificacoes() {
            const resultDiv = document.getElementById('test-results');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = ' Testando notificações...';
            
            try {
                const response = await fetch('/api/jornada/gerar-notificacoes', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-results test-success';
                    resultDiv.innerHTML = `
                        <h4>✅ Sistema de Notificações - FUNCIONANDO</h4>
                        <p><strong>Status:</strong> ${data.message}</p>
                        <p><strong>Notificações processadas:</strong> ${data.notificacoes_enviadas}</p>
                        <p>Sistema de notificações automáticas está ativo e funcionando.</p>
                    `;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                resultDiv.className = 'test-results test-error';
                resultDiv.innerHTML = `
                    <h4>❌ Sistema de Notificações - FALHOU</h4>
                    <p>Erro: ${error.message}</p>
                `;
            }
        }
    </script>
    
    <!-- Sistema de Efeitos Visuais -->
    <script src="visual-effects.js"></script>
</body>
</html>
