<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Atendimento - Dr. Marcio Scartozzoni</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header-left h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header-left p {
            opacity: 0.9;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-voltar {
            background: #6c757d;
            color: white;
        }

        .btn-salvar {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-gerar-pdf {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .ficha-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .antropometria-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .imc-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
        }

        .imc-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .imc-classification {
            font-size: 0.9em;
            margin-top: 5px;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: 500;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .expectativa-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .expectativa-btn {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .expectativa-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .indicacoes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .indicacao-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .indicacao-card.selected {
            background: #e8f0fe;
            border-color: #667eea;
        }

        .indicacao-card h4 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 1em;
        }

        .indicacao-card p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }

        .actions-bar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .paciente-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .paciente-search {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .paciente-search input {
            flex: 1;
        }

        .btn-buscar {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .header-actions {
                flex-wrap: wrap;
                justify-content: center;
            }

            .antropometria-grid {
                grid-template-columns: 1fr;
            }

            .actions-bar {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1><i class="fas fa-clipboard-list"></i> Ficha de Atendimento</h1>
                <p>Avalia√ß√£o Inicial - Cirurgia Pl√°stica</p>
            </div>
            <div class="header-actions">
                <a href="../index.html" class="btn btn-voltar">
                    <i class="fas fa-arrow-left"></i> Voltar ao Portal
                </a>
                <button onclick="salvarFicha()" class="btn btn-salvar">
                    <i class="fas fa-save"></i> Salvar Ficha
                </button>
                <button onclick="gerarPDF()" class="btn btn-gerar-pdf">
                    <i class="fas fa-file-pdf"></i> Gerar PDF
                </button>
            </div>
        </div>

        <!-- Busca/Sele√ß√£o do Paciente -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-user"></i> Dados do Paciente
            </div>
            
            <div class="paciente-info">
                <div class="paciente-search">
                    <input type="text" id="buscaPaciente" placeholder="Digite nome, CPF ou prontu√°rio do paciente">
                    <button class="btn-buscar" onclick="buscarPaciente()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
                <div id="pacienteSelecionado" style="display: none;">
                    <h4 id="nomePaciente"></h4>
                    <p id="dadosPaciente"></p>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="nomePacienteCompleto">Nome Completo</label>
                    <input type="text" id="nomePacienteCompleto" required>
                </div>
                <div class="form-group">
                    <label for="cpfPaciente">CPF</label>
                    <input type="text" id="cpfPaciente" data-type="cpf">
                </div>
                <div class="form-group">
                    <label for="dataNascimento">Data de Nascimento</label>
                    <input type="date" id="dataNascimento">
                </div>
                <div class="form-group">
                    <label for="telefonePaciente">Telefone</label>
                    <input type="tel" id="telefonePaciente">
                </div>
                <div class="form-group">
                    <label for="emailPaciente">E-mail</label>
                    <input type="email" id="emailPaciente">
                </div>
                <div class="form-group">
                    <label for="profissao">Profiss√£o</label>
                    <input type="text" id="profissao">
                </div>
            </div>
        </div>

        <!-- Queixa Principal -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-comments"></i> Queixa Principal do Paciente
            </div>
            
            <div class="form-group">
                <label for="queixaPrincipal">Descreva a queixa principal e motiva√ß√£o para a consulta</label>
                <textarea id="queixaPrincipal" placeholder="Ex: Paciente relata insatisfa√ß√£o com formato do nariz, solicita avalia√ß√£o para rinoplastia..."></textarea>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="tempoQueixa">H√° quanto tempo tem essa queixa?</label>
                    <select id="tempoQueixa">
                        <option value="">Selecione...</option>
                        <option value="menos-6-meses">Menos de 6 meses</option>
                        <option value="6-12-meses">6 a 12 meses</option>
                        <option value="1-2-anos">1 a 2 anos</option>
                        <option value="2-5-anos">2 a 5 anos</option>
                        <option value="mais-5-anos">Mais de 5 anos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="jaConsultouOutros">J√° consultou outros profissionais?</label>
                    <select id="jaConsultouOutros">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o</option>
                        <option value="sim-cirurgiao">Sim, cirurgi√£o pl√°stico</option>
                        <option value="sim-outros">Sim, outros especialistas</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Hist√≥rico Pr√©vio -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-history"></i> Hist√≥rico M√©dico Pr√©vio
            </div>

            <div class="form-group">
                <label for="historicoMedico">Hist√≥rico de doen√ßas, cirurgias anteriores e medicamentos em uso</label>
                <textarea id="historicoMedico" placeholder="Descreva hist√≥rico m√©dico completo, cirurgias anteriores, medicamentos em uso, alergias..."></textarea>
            </div>

            <div class="form-group">
                <label>Antecedentes relevantes (marque os que se aplicam):</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="diabetes" name="antecedentes" value="diabetes">
                        <label for="diabetes">Diabetes</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="hipertensao" name="antecedentes" value="hipertensao">
                        <label for="hipertensao">Hipertens√£o</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="cardiopatia" name="antecedentes" value="cardiopatia">
                        <label for="cardiopatia">Cardiopatia</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="alergias" name="antecedentes" value="alergias">
                        <label for="alergias">Alergias</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="tabagismo" name="antecedentes" value="tabagismo">
                        <label for="tabagismo">Tabagismo</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="etilismo" name="antecedentes" value="etilismo">
                        <label for="etilismo">Etilismo</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="cirurgias-previas" name="antecedentes" value="cirurgias-previas">
                        <label for="cirurgias-previas">Cirurgias Pr√©vias</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="anestesia-problemas" name="antecedentes" value="anestesia-problemas">
                        <label for="anestesia-problemas">Problemas com Anestesia</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="medicamentosUso">Medicamentos em uso regular</label>
                <textarea id="medicamentosUso" rows="3" placeholder="Liste medicamentos, dosagens e frequ√™ncia..."></textarea>
            </div>
        </div>

        <!-- Dados Antropom√©tricos -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-weight"></i> Dados Antropom√©tricos
            </div>

            <div class="antropometria-grid">
                <div class="form-group">
                    <label for="peso">Peso (kg)</label>
                    <input type="number" id="peso" step="0.1" min="0" max="300" onchange="calcularIMC()">
                </div>
                <div class="form-group">
                    <label for="altura">Altura (cm)</label>
                    <input type="number" id="altura" min="100" max="250" onchange="calcularIMC()">
                </div>
                <div class="form-group">
                    <label>IMC Calculado</label>
                    <div class="imc-result">
                        <div class="imc-value" id="imcValor">--</div>
                        <div class="imc-classification" id="imcClassificacao">Informe peso e altura</div>
                    </div>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="pressaoArterial">Press√£o Arterial</label>
                    <input type="text" id="pressaoArterial" placeholder="Ex: 120/80 mmHg">
                </div>
                <div class="form-group">
                    <label for="frequenciaCardiaca">Frequ√™ncia Card√≠aca</label>
                    <input type="number" id="frequenciaCardiaca" placeholder="Ex: 70 bpm">
                </div>
            </div>
        </div>

        <!-- Exame F√≠sico -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-stethoscope"></i> Exame F√≠sico
            </div>

            <div class="form-group">
                <label for="exameFisicoGeral">Exame F√≠sico Geral</label>
                <textarea id="exameFisicoGeral" placeholder="Descreva o estado geral do paciente, apar√™ncia, mobilidade..."></textarea>
            </div>

            <div class="form-group">
                <label for="exameFisicoLocal">Exame F√≠sico Local/Espec√≠fico</label>
                <textarea id="exameFisicoLocal" placeholder="Descreva os achados espec√≠ficos da regi√£o de interesse para o procedimento..."></textarea>
            </div>

            <div class="form-group">
                <label for="fotosClincias">Documenta√ß√£o Fotogr√°fica</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="file" id="fotosClincias" multiple accept="image/*">
                    <button type="button" onclick="tirarFoto()" class="btn" style="background: #17a2b8; color: white;">
                        <i class="fas fa-camera"></i> Tirar Foto
                    </button>
                </div>
                <small style="color: #6c757d;">Documenta√ß√£o fotogr√°fica para acompanhamento cl√≠nico</small>
            </div>
        </div>

        <!-- Expectativas do Paciente -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-bullseye"></i> Expectativas do Paciente
            </div>

            <div class="form-group">
                <label for="expectativasDetalhadas">Descreva detalhadamente as expectativas do paciente</label>
                <textarea id="expectativasDetalhadas" placeholder="Detalhe o que o paciente espera alcan√ßar com o procedimento..."></textarea>
            </div>

            <div class="form-group">
                <label>Grau de expectativa (selecione uma ou mais):</label>
                <div class="expectativa-buttons">
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'realista')">Realista</button>
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'alta')">Expectativa Alta</button>
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'irrealista')">Irrealista</button>
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'ansiosa')">Paciente Ansioso</button>
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'bem-informado')">Bem Informado</button>
                    <button type="button" class="expectativa-btn" onclick="toggleExpectativa(this, 'primeira-consulta')">Primeira Consulta</button>
                </div>
            </div>

            <div class="form-group">
                <label for="motivacaoReal">Motiva√ß√£o real para o procedimento</label>
                <textarea id="motivacaoReal" rows="3" placeholder="Analise a motiva√ß√£o real do paciente (autoestima, profissional, pessoal, etc.)"></textarea>
            </div>
        </div>

        <!-- Indica√ß√µes Cir√∫rgicas -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-medical"></i> Indica√ß√µes Cir√∫rgicas
            </div>

            <div class="form-group">
                <label>Selecione os procedimentos indicados/discutidos:</label>
                <div class="indicacoes-grid">
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'rinoplastia')">
                        <h4><i class="fas fa-head-side-mask"></i> Rinoplastia</h4>
                        <p>Cirurgia do nariz est√©tica e/ou funcional</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'blefaroplastia')">
                        <h4><i class="fas fa-eye"></i> Blefaroplastia</h4>
                        <p>Cirurgia das p√°lpebras</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'mamoplastia-aumento')">
                        <h4><i class="fas fa-plus-circle"></i> Mamoplastia Aumento</h4>
                        <p>Aumento das mamas</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'mamoplastia-reducao')">
                        <h4><i class="fas fa-minus-circle"></i> Mamoplastia Redu√ß√£o</h4>
                        <p>Redu√ß√£o das mamas</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'abdominoplastia')">
                        <h4><i class="fas fa-compress-alt"></i> Abdominoplastia</h4>
                        <p>Cirurgia do abdome</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'lipoaspiracao')">
                        <h4><i class="fas fa-wind"></i> Lipoaspira√ß√£o</h4>
                        <p>Remo√ß√£o de gordura localizada</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'lifting-facial')">
                        <h4><i class="fas fa-smile"></i> Lifting Facial</h4>
                        <p>Rejuvenescimento facial</p>
                    </div>
                    <div class="indicacao-card" onclick="toggleIndicacao(this, 'otoplastia')">
                        <h4><i class="fas fa-assistive-listening-systems"></i> Otoplastia</h4>
                        <p>Cirurgia das orelhas</p>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="indicacaoDetalhada">Indica√ß√£o m√©dica detalhada</label>
                <textarea id="indicacaoDetalhada" placeholder="Descreva a indica√ß√£o m√©dica, t√©cnica recomendada, riscos e benef√≠cios..."></textarea>
            </div>

            <div class="form-group">
                <label for="contraindicacoes">Contraindica√ß√µes ou restri√ß√µes identificadas</label>
                <textarea id="contraindicacoes" rows="3" placeholder="Liste contraindica√ß√µes m√©dicas, psicol√≥gicas ou t√©cnicas..."></textarea>
            </div>
        </div>

        <!-- Observa√ß√µes e Conduta -->
        <div class="ficha-container">
            <div class="section-title">
                <i class="fas fa-notes-medical"></i> Observa√ß√µes e Conduta
            </div>

            <div class="form-group">
                <label for="observacoes">Observa√ß√µes adicionais</label>
                <textarea id="observacoes" placeholder="Observa√ß√µes gerais, orienta√ß√µes dadas, pr√≥ximos passos..."></textarea>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="retorno">Agendamento de retorno</label>
                    <input type="date" id="retorno">
                </div>
                <div class="form-group">
                    <label for="conduta">Conduta imediata</label>
                    <select id="conduta">
                        <option value="">Selecione...</option>
                        <option value="agendar-cirurgia">Agendar cirurgia</option>
                        <option value="solicitar-exames">Solicitar exames pr√©-operat√≥rios</option>
                        <option value="periodo-reflexao">Per√≠odo de reflex√£o</option>
                        <option value="avaliacao-complementar">Avalia√ß√£o complementar</option>
                        <option value="contraindicado">Contraindicado no momento</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Barra de A√ß√µes -->
        <div class="actions-bar">
            <div>
                <strong>Ficha preenchida em:</strong> <span id="dataAtendimento"></span>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="limparFicha()" class="btn" style="background: #6c757d; color: white;">
                    <i class="fas fa-eraser"></i> Limpar
                </button>
                <button onclick="salvarRascunho()" class="btn" style="background: #ffc107; color: #212529;">
                    <i class="fas fa-save"></i> Salvar Rascunho
                </button>
                <button onclick="salvarFicha()" class="btn btn-salvar">
                    <i class="fas fa-check"></i> Finalizar Atendimento
                </button>
            </div>
        </div>
    </div>

    <script src="../assets/js/auth-guard.js"></script>
    <script>
        // Vari√°veis globais
        let expectativasSelecionadas = [];
        let indicacoesSelecionadas = [];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual
            document.getElementById('dataAtendimento').textContent = 
                new Date().toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

            // Log de auditoria
            AuditSystem.log('FICHA_ATENDIMENTO_OPENED');
        });

        // Fun√ß√£o para buscar paciente
        function buscarPaciente() {
            const termo = document.getElementById('buscaPaciente').value.trim();
            if (!termo) {
                SecureNotification.error('Digite um termo para busca');
                return;
            }

            // Simula√ß√£o de busca
            SecureNotification.show('üîç Buscando paciente...');
            
            setTimeout(() => {
                // Simula√ß√£o de paciente encontrado
                const pacienteEncontrado = {
                    nome: 'Maria Silva Santos',
                    cpf: '123.456.789-00',
                    nascimento: '1985-05-15',
                    telefone: '(11) 99999-9999',
                    email: 'maria.silva@email.com'
                };

                preencherDadosPaciente(pacienteEncontrado);
                SecureNotification.success('Paciente encontrado!');
            }, 1000);
        }

        function preencherDadosPaciente(paciente) {
            document.getElementById('nomePacienteCompleto').value = paciente.nome;
            document.getElementById('cpfPaciente').value = paciente.cpf;
            document.getElementById('dataNascimento').value = paciente.nascimento;
            document.getElementById('telefonePaciente').value = paciente.telefone;
            document.getElementById('emailPaciente').value = paciente.email;

            // Mostrar dados do paciente selecionado
            document.getElementById('nomePaciente').textContent = paciente.nome;
            document.getElementById('dadosPaciente').textContent = 
                `CPF: ${paciente.cpf} | Nascimento: ${new Date(paciente.nascimento).toLocaleDateString('pt-BR')}`;
            document.getElementById('pacienteSelecionado').style.display = 'block';
        }

        // Fun√ß√£o para calcular IMC
        function calcularIMC() {
            const peso = parseFloat(document.getElementById('peso').value);
            const altura = parseFloat(document.getElementById('altura').value);

            if (peso && altura) {
                const alturaM = altura / 100;
                const imc = peso / (alturaM * alturaM);
                
                document.getElementById('imcValor').textContent = imc.toFixed(1);
                
                let classificacao = '';
                let cor = '';
                
                if (imc < 18.5) {
                    classificacao = 'Abaixo do peso';
                    cor = '#17a2b8';
                } else if (imc < 25) {
                    classificacao = 'Peso normal';
                    cor = '#28a745';
                } else if (imc < 30) {
                    classificacao = 'Sobrepeso';
                    cor = '#ffc107';
                } else if (imc < 35) {
                    classificacao = 'Obesidade Grau I';
                    cor = '#fd7e14';
                } else if (imc < 40) {
                    classificacao = 'Obesidade Grau II';
                    cor = '#dc3545';
                } else {
                    classificacao = 'Obesidade Grau III';
                    cor = '#6f42c1';
                }
                
                const classElement = document.getElementById('imcClassificacao');
                classElement.textContent = classificacao;
                classElement.style.backgroundColor = cor;
                classElement.style.color = 'white';
            } else {
                document.getElementById('imcValor').textContent = '--';
                document.getElementById('imcClassificacao').textContent = 'Informe peso e altura';
                document.getElementById('imcClassificacao').style.backgroundColor = '#f8f9fa';
                document.getElementById('imcClassificacao').style.color = '#6c757d';
            }
        }

        // Fun√ß√£o para toggle de expectativas
        function toggleExpectativa(button, valor) {
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                if (!expectativasSelecionadas.includes(valor)) {
                    expectativasSelecionadas.push(valor);
                }
            } else {
                expectativasSelecionadas = expectativasSelecionadas.filter(e => e !== valor);
            }
        }

        // Fun√ß√£o para toggle de indica√ß√µes
        function toggleIndicacao(card, valor) {
            card.classList.toggle('selected');
            
            if (card.classList.contains('selected')) {
                if (!indicacoesSelecionadas.includes(valor)) {
                    indicacoesSelecionadas.push(valor);
                }
            } else {
                indicacoesSelecionadas = indicacoesSelecionadas.filter(i => i !== valor);
            }
        }

        // Fun√ß√£o para tirar foto
        function tirarFoto() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                SecureNotification.show('üì∑ Recurso de c√¢mera em desenvolvimento!\n\nEm breve ser√° poss√≠vel tirar fotos diretamente na ficha.');
            } else {
                SecureNotification.warning('C√¢mera n√£o dispon√≠vel neste dispositivo');
            }
        }

        // Fun√ß√£o para salvar ficha
        function salvarFicha() {
            // Validar campos obrigat√≥rios
            const nome = document.getElementById('nomePacienteCompleto').value;
            const queixa = document.getElementById('queixaPrincipal').value;
            
            if (!nome || !queixa) {
                SecureNotification.error('Preencha pelo menos o nome do paciente e a queixa principal');
                return;
            }

            // Coletar dados da ficha
            const fichaData = coletarDadosFicha();
            
            // Simular salvamento
            SecureNotification.show('üíæ Salvando ficha de atendimento...');
            
            setTimeout(() => {
                // Log de auditoria
                AuditSystem.log('FICHA_ATENDIMENTO_SAVED', {
                    paciente: nome,
                    indicacoes: indicacoesSelecionadas
                });
                
                SecureNotification.success('‚úÖ Ficha de atendimento salva com sucesso!');
            }, 1500);
        }

        function coletarDadosFicha() {
            // Coletar antecedentes selecionados
            const antecedentes = [];
            document.querySelectorAll('input[name="antecedentes"]:checked').forEach(checkbox => {
                antecedentes.push(checkbox.value);
            });

            return {
                // Dados do paciente
                nome: document.getElementById('nomePacienteCompleto').value,
                cpf: document.getElementById('cpfPaciente').value,
                nascimento: document.getElementById('dataNascimento').value,
                telefone: document.getElementById('telefonePaciente').value,
                email: document.getElementById('emailPaciente').value,
                profissao: document.getElementById('profissao').value,
                
                // Queixa
                queixaPrincipal: document.getElementById('queixaPrincipal').value,
                tempoQueixa: document.getElementById('tempoQueixa').value,
                jaConsultouOutros: document.getElementById('jaConsultouOutros').value,
                
                // Hist√≥rico
                historicoMedico: document.getElementById('historicoMedico').value,
                antecedentes: antecedentes,
                medicamentos: document.getElementById('medicamentosUso').value,
                
                // Antropometria
                peso: document.getElementById('peso').value,
                altura: document.getElementById('altura').value,
                pressao: document.getElementById('pressaoArterial').value,
                frequencia: document.getElementById('frequenciaCardiaca').value,
                
                // Exame f√≠sico
                exameFisicoGeral: document.getElementById('exameFisicoGeral').value,
                exameFisicoLocal: document.getElementById('exameFisicoLocal').value,
                
                // Expectativas
                expectativasDetalhadas: document.getElementById('expectativasDetalhadas').value,
                expectativasSelecionadas: expectativasSelecionadas,
                motivacao: document.getElementById('motivacaoReal').value,
                
                // Indica√ß√µes
                indicacoesSelecionadas: indicacoesSelecionadas,
                indicacaoDetalhada: document.getElementById('indicacaoDetalhada').value,
                contraindicacoes: document.getElementById('contraindicacoes').value,
                
                // Conduta
                observacoes: document.getElementById('observacoes').value,
                retorno: document.getElementById('retorno').value,
                conduta: document.getElementById('conduta').value,
                
                dataAtendimento: new Date().toISOString()
            };
        }

        function salvarRascunho() {
            const dados = coletarDadosFicha();
            localStorage.setItem('rascunho_ficha_atendimento', JSON.stringify(dados));
            SecureNotification.success('üìù Rascunho salvo!');
        }

        function limparFicha() {
            if (confirm('Tem certeza que deseja limpar todos os dados da ficha?')) {
                document.querySelectorAll('input, textarea, select').forEach(field => {
                    if (field.type === 'checkbox') {
                        field.checked = false;
                    } else {
                        field.value = '';
                    }
                });
                
                // Limpar sele√ß√µes
                expectativasSelecionadas = [];
                indicacoesSelecionadas = [];
                
                document.querySelectorAll('.expectativa-btn.active').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.querySelectorAll('.indicacao-card.selected').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Resetar IMC
                calcularIMC();
                
                SecureNotification.success('üóëÔ∏è Ficha limpa!');
            }
        }

        function gerarPDF() {
            const nome = document.getElementById('nomePacienteCompleto').value;
            if (!nome) {
                SecureNotification.error('Preencha o nome do paciente para gerar o PDF');
                return;
            }

            SecureNotification.show('üìÑ Gerando PDF da ficha de atendimento...');
            
            setTimeout(() => {
                AuditSystem.log('FICHA_PDF_GENERATED', { paciente: nome });
                SecureNotification.success('‚úÖ PDF gerado com sucesso!\n\nEm ambiente de produ√ß√£o, o arquivo seria baixado automaticamente.');
            }, 2000);
        }
    </script>
</body>
</html>
